# /cve-fixer.jira-process - Process CVE Issues from JIRA Component

## Purpose
Fetches all CVE-related issues from a specified JIRA component, analyzes each one to determine if a fix is mentioned, and attempts to implement fixes for issues that need resolution.

## Prerequisites
- JIRA MCP server configured with credentials (JIRA_URL, JIRA_EMAIL, JIRA_API_TOKEN)
- User must provide a JIRA component name
- Access to the JIRA project containing CVE issues

## Process

1. **Get JIRA Component from User**
   - Ask user: "Which JIRA component would you like to process? (e.g., 'security', 'backend-api')"
   - Validate the component exists in JIRA
   - Confirm the project key if needed

2. **Fetch Issues by Component**
   - Use JIRA MCP tools to search for issues: `component = "COMPONENT_NAME" AND resolution = Unresolved`
   - Filter for CVE-related issues (check summary/description for "CVE" keywords)
   - Display total count of issues found
   - Ask user for confirmation to proceed

3. **Process Each Issue Sequentially**
   - For each issue in the list:
     - Fetch full issue details (description, comments, attachments, custom fields)
     - Display issue key, summary, and priority
     - Analyze content for existing fix information

4. **Extract GitHub Repository from Issue**
   - Search issue description for:
     - GitHub repository URLs (https://github.com/owner/repo)
     - Repository references (owner/repo format)
     - Git clone commands
   - Search issue comments for repository links
   - Check custom fields for repository information
   - If repository found: Display and confirm with user
   - If NOT found: Ask user "Which GitHub repository should this fix be applied to?"

5. **Analyze Issue for Existing Fix**
   - Check issue description for:
     - Fix/patch version mentioned
     - Workaround instructions
     - Pull request links
     - Commit references
   - Check comments for:
     - Developer responses with fixes
     - Links to solutions
     - Status updates indicating fix is in progress
   - Determine fix status: "No fix mentioned", "Fix available", "Fix in progress"

6. **Analyze and Explain Fix (if no fix exists)**
   - Extract CVE ID from issue
   - Identify affected package/dependency from issue description
   - Search for available patches/upgrades
   - Determine fix strategy:
     - Version upgrade
     - Configuration change
     - Code modification
     - Workaround implementation
   - **Provide detailed fix instructions:**
     - Explain what the CVE is and why it's dangerous
     - List specific files that need modification
     - Show exact locations in files (line numbers, functions, sections)
     - Provide code snippets showing what should change
     - Explain the reasoning behind each change
   - **NOTE: NO file edits will be made - instructions only**
   - **NOTE: JIRA issues are READ-ONLY - no updates will be made to JIRA**

7. **Generate Summary Report**
   - Save processing results to: `artifacts/cve-fixer/jira-processing/{component}-{timestamp}.md`
   - Include for each issue:
     - JIRA issue key and summary
     - CVE ID and severity
     - GitHub repository (extracted or user-provided)
     - Fix status (existing fix found / needs fix / in progress)
     - **Detailed fix instructions** if no fix exists:
       - Files to modify with full paths
       - Exact locations to change (line numbers, function names)
       - Before/after code snippets
       - Step-by-step implementation guide
     - Links to JIRA issue for reference
     - Links to related PRs/commits if mentioned in JIRA

## Output
- **Processing Log**: `artifacts/cve-fixer/jira-processing/{component}-{timestamp}.md`
  - Detailed analysis of each JIRA issue
  - GitHub repository identified for each issue
  - Fix status determined for each issue
  - **Complete fix instructions** for issues requiring fixes:
    - Which files to modify
    - Where in each file to make changes (line numbers, sections)
    - What code changes are needed (before/after snippets)
    - Why each change is necessary
  - JIRA issue links (read-only references)

- **Fix Instructions Summary**: `artifacts/cve-fixer/reports/jira-fixes-{component}-{timestamp}.md`
  - Executive summary of issues analyzed
  - Quick reference guide for implementing fixes
  - Issues grouped by repository
  - Prioritized list (Critical → High → Medium → Low)
  - **NOTE: All changes must be implemented manually by user**

## Usage Examples

Basic usage:
```
/cve-fixer.jira-process
```

The command will prompt you for the JIRA component.

Inline specification:
```
/cve-fixer.jira-process security
```

Process specific project:
```
Process JIRA issues for component "backend-api" in project SEC
```

## Success Criteria

After running this command, you should have:
- [ ] All issues from the component fetched and analyzed (read-only)
- [ ] GitHub repositories identified or confirmed for each issue
- [ ] Fix status determined for each issue
- [ ] **Detailed fix instructions generated** for issues needing fixes
- [ ] Summary report with step-by-step implementation guide
- [ ] **IMPORTANT: No changes made to JIRA issues**
- [ ] **IMPORTANT: No changes made to repository files**
- [ ] **IMPORTANT: No pull requests created**

## Next Steps

After completing this phase:
1. Review the processing log in `artifacts/cve-fixer/jira-processing/`
2. Review the fix instructions summary in `artifacts/cve-fixer/reports/`
3. **Manually implement the fixes** following the provided instructions:
   - Clone the identified GitHub repositories
   - Create feature branches for each fix
   - Make the code changes as described
   - Test the fixes locally
   - Create pull requests with fix details
4. Update JIRA issues manually with PR links and fix status

## Notes

**JIRA READ-ONLY POLICY:**
- ✅ ALLOWED: Fetching issues, reading descriptions, reading comments
- ❌ FORBIDDEN: Adding comments, updating fields, changing status, creating issues
- All JIRA access is READ-ONLY - no modifications will be made to JIRA
- Users must manually update JIRA issues based on the generated report

**REPOSITORY READ-ONLY POLICY:**
- ✅ ALLOWED: Reading repository information from JIRA, analyzing CVEs
- ❌ FORBIDDEN: Editing files, creating branches, making commits, creating PRs
- All repository access is READ-ONLY - no code changes will be made
- Workflow provides **instructions only** - user implements fixes manually

**GitHub Repository Detection:**
- Workflow attempts to extract repository from JIRA issue automatically
- Searches: description, comments, custom fields
- If not found: prompts user for repository information
- If found: confirms with user before proceeding

**Processing Behavior:**
- Processing stops if JIRA authentication fails
- Issues are processed sequentially to avoid rate limiting
- Critical/High priority issues are analyzed first
- The command respects JIRA rate limits (adds delays between API calls)
- Large components (>50 issues) will prompt for batch processing confirmation

## JIRA Query Examples

The command uses JQL (JIRA Query Language) internally:

```jql
# Basic query
component = "security" AND resolution = Unresolved

# With CVE filter
component = "security" AND summary ~ "CVE" AND resolution = Unresolved

# Priority filtering
component = "security" AND priority in (Critical, High) AND resolution = Unresolved
```

## Error Handling

- **Component not found**: Suggests similar component names
- **No issues found**: Confirms query and suggests expanding search
- **JIRA authentication failure**: Prompts to check environment variables
- **Rate limit exceeded**: Automatically waits and retries
- **Fix application failure**: Logs error and continues to next issue
