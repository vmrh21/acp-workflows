# /cve-fixer.jira-process - Process CVE Issues from JIRA Component

## Purpose
Fetches all CVE-related issues from a specified JIRA component, analyzes each one to determine if a fix is mentioned, and attempts to implement fixes for issues that need resolution.

## Prerequisites
- JIRA MCP server configured with credentials (JIRA_URL, JIRA_EMAIL, JIRA_API_TOKEN)
- User must provide a JIRA component name
- Access to the JIRA project containing CVE issues

## Process

1. **Get JIRA Component from User**
   - Ask user: "Which JIRA component would you like to process? (e.g., 'security', 'backend-api')"
   - Validate the component exists in JIRA
   - Confirm the project key if needed

2. **Fetch ALL Issues by Component**
   - Use JIRA MCP tools to search for ALL issues: `component = "COMPONENT_NAME" AND summary ~ "CVE"`
   - **IMPORTANT: Fetch ALL issues, not just a subset**
   - Include both open AND closed issues
   - Display initial count: "Found X total issues (processing all)"
   - Show progress as fetching: "Fetching issue 1 of X...", "Fetching issue 2 of X...", etc.
   - Ask user for confirmation to proceed with full analysis

3. **Categorize Issues by Status**
   - Group fetched issues into:
     - **Open Issues**: Status = Open, In Progress, To Do, etc.
     - **Closed Issues**: Status = Done, Closed, Resolved, etc.
   - Display counts:
     ```
     Total CVE Issues: X
     ‚îú‚îÄ Open Issues: Y
     ‚îî‚îÄ Closed Issues: Z
     ```
   - Show user what will be processed

4. **Process Each Issue Sequentially with Progress**
   - **Show real-time progress**: "Processing issue 3 of 15: SEC-1234..."
   - For each issue:
     - Display: `[3/15] SEC-1234 | CVE-2024-1234 | Critical | Status: Open`
     - Fetch full issue details (description, comments, attachments, custom fields)
     - Extract CVE ID from summary/description
     - Identify issue status (open/closed)
     - Show what's being analyzed: "Reading description...", "Checking comments...", "Extracting repo info..."

5. **Extract CVE ID and Group Issues**
   - Extract CVE ID from each issue (summary/description)
   - Group issues by CVE ID:
     ```
     CVE-2024-1234:
       ‚îú‚îÄ SEC-1234 (Open) - node-forge package
       ‚îî‚îÄ SEC-1235 (Closed) - duplicate issue

     CVE-2024-5678:
       ‚îî‚îÄ SEC-1236 (Open) - lodash package
     ```
   - Identify duplicate CVE entries
   - Show which CVEs have multiple JIRA issues
   - Display: "Found X unique CVEs across Y issues"

6. **Extract GitHub Repository from Issue**
   - For each issue, search description for:
     - GitHub repository URLs (https://github.com/owner/repo)
     - Repository references (owner/repo format)
     - Git clone commands
   - Search issue comments for repository links
   - Check custom fields for repository information
   - Show progress: "Repo found: https://github.com/..." or "Repo not found - will ask user"
   - If repository found: Display and note for later
   - If NOT found: Mark for user input (ask once per unique CVE, not per issue)

7. **Analyze Each CVE for Existing Fixes**
   - **For each unique CVE** (not each JIRA issue):
     - Show: "Analyzing CVE-2024-1234 (found in 2 issues)..."
     - Check ALL associated JIRA issues for fix information
     - Look in descriptions for:
       - Fix/patch version mentioned
       - Workaround instructions
       - Pull request links
       - Commit references
     - Look in comments across all issues for:
       - Developer responses with fixes
       - Links to solutions
       - Status updates indicating fix is in progress
     - For closed issues: Note what the resolution was
     - Determine overall fix status: "No fix mentioned", "Fix available in issue X", "Fixed (closed issues)", "Fix in progress"
     - Show result: "CVE-2024-1234: Fix available (upgrade to v1.3.2 mentioned in SEC-1234)"

8. **Analyze and Explain Fix (for CVEs needing fixes)**
   - **Only for CVEs without existing fixes** (skip closed/fixed ones)
   - Extract CVE ID from issue
   - Identify affected package/dependency from issue description
   - Search for available patches/upgrades
   - Determine fix strategy:
     - Version upgrade
     - Configuration change
     - Code modification
     - Workaround implementation
   - **Provide detailed fix instructions:**
     - Explain what the CVE is and why it's dangerous
     - List specific files that need modification
     - Show exact locations in files (line numbers, functions, sections)
     - Provide code snippets showing what should change
     - Explain the reasoning behind each change
   - Show progress: "Generating fix instructions for CVE-2024-1234..."
   - **NOTE: NO file edits will be made - instructions only**
   - **NOTE: JIRA issues are READ-ONLY - no updates will be made to JIRA**

9. **Generate Comprehensive Summary Report**
   - Save processing results to: `artifacts/cve-fixer/jira-processing/{component}-{timestamp}.md`
   - **Report Structure:**

     **Section 1: Executive Summary**
     - Total issues processed: X
     - Total unique CVEs found: Y
     - Open vs Closed breakdown
     - CVEs requiring immediate action: Z

     **Section 2: CVE Groupings**
     - Group by CVE ID showing all related JIRA issues:
       ```
       CVE-2024-1234 (Critical):
         Issues: SEC-1234 (Open), SEC-1235 (Closed - duplicate)
         Status: Open - needs fix
         Repository: https://github.com/company/backend-api
         Package: node-forge@1.3.1
       ```

     **Section 3: Detailed Analysis Per CVE**
     - For each unique CVE:
       - CVE ID and severity
       - All associated JIRA issue keys
       - GitHub repository (extracted or user-provided)
       - Fix status across all issues
       - **Detailed fix instructions** if no fix exists:
         - Files to modify with full paths
         - Exact locations to change (line numbers, function names)
         - Before/after code snippets
         - Step-by-step implementation guide
       - Links to all related JIRA issues
       - Links to related PRs/commits if mentioned

     **Section 4: Closed/Fixed CVEs**
     - List of CVEs already resolved
     - What the fix was (from closed issue resolution)
     - Verification recommendations

## Output

### Real-Time Progress Display
During execution, user sees:
```
üîç Fetching CVE issues from component "security"...
Found 15 total issues

üìä Categorizing issues...
Total CVE Issues: 15
‚îú‚îÄ Open Issues: 8
‚îî‚îÄ Closed Issues: 7

üî¨ Processing all 15 issues...

[1/15] SEC-1234 | CVE-2024-1234 | Critical | Status: Open
  ‚îú‚îÄ Reading description...
  ‚îú‚îÄ Checking comments...
  ‚îî‚îÄ Repo found: https://github.com/company/backend-api

[2/15] SEC-1235 | CVE-2024-1234 | High | Status: Closed
  ‚îú‚îÄ Duplicate of SEC-1234
  ‚îî‚îÄ Resolution: Fixed in v1.3.2

[3/15] SEC-1236 | CVE-2024-5678 | High | Status: Open
  ‚îú‚îÄ No repo found - will ask user later
  ...

üß© Grouping by CVE...
Found 10 unique CVEs across 15 issues

üìù Generating fix instructions...
[1/10] CVE-2024-1234: Analyzing...
  ‚îú‚îÄ Found in 2 issues (1 open, 1 closed)
  ‚îú‚îÄ Fix available in SEC-1235
  ‚îî‚îÄ Skipping detailed analysis

[2/10] CVE-2024-5678: Analyzing...
  ‚îú‚îÄ Found in 1 issue (open)
  ‚îú‚îÄ No fix mentioned
  ‚îî‚îÄ Generating instructions...

‚úÖ Processing complete!
```

### Generated Files

- **Processing Log**: `artifacts/cve-fixer/jira-processing/{component}-{timestamp}.md`
  - **Executive Summary**: Counts, breakdowns, actions needed
  - **CVE Groupings**: All issues grouped by CVE ID
  - **Detailed Analysis per CVE**:
    - All associated JIRA issues
    - Status across all issues
    - GitHub repositories identified
    - Fix status determined
    - **Complete fix instructions** for CVEs needing fixes:
      - Which files to modify
      - Where in each file to make changes (line numbers, sections)
      - What code changes are needed (before/after snippets)
      - Why each change is necessary
  - **Closed/Fixed CVEs**: What was already resolved
  - All JIRA issue links (read-only references)

- **Fix Instructions Summary**: `artifacts/cve-fixer/reports/jira-fixes-{component}-{timestamp}.md`
  - Quick reference guide for implementing fixes
  - **CVEs grouped by status**:
    - Open & needs fix
    - Open but fix mentioned
    - Closed/resolved
  - Issues grouped by repository
  - Prioritized list (Critical ‚Üí High ‚Üí Medium ‚Üí Low)
  - Duplicate CVE detection results
  - **NOTE: All changes must be implemented manually by user**

## Usage Examples

Basic usage:
```
/cve-fixer.jira-process
```

The command will prompt you for the JIRA component.

Inline specification:
```
/cve-fixer.jira-process security
```

Process specific project:
```
Process JIRA issues for component "backend-api" in project SEC
```

## Success Criteria

After running this command, you should have:
- [ ] All issues from the component fetched and analyzed (read-only)
- [ ] GitHub repositories identified or confirmed for each issue
- [ ] Fix status determined for each issue
- [ ] **Detailed fix instructions generated** for issues needing fixes
- [ ] Summary report with step-by-step implementation guide
- [ ] **IMPORTANT: No changes made to JIRA issues**
- [ ] **IMPORTANT: No changes made to repository files**
- [ ] **IMPORTANT: No pull requests created**

## Next Steps

After completing this phase:
1. Review the processing log in `artifacts/cve-fixer/jira-processing/`
2. Review the fix instructions summary in `artifacts/cve-fixer/reports/`
3. **Manually implement the fixes** following the provided instructions:
   - Clone the identified GitHub repositories
   - Create feature branches for each fix
   - Make the code changes as described
   - Test the fixes locally
   - Create pull requests with fix details
4. Update JIRA issues manually with PR links and fix status

## Notes

**JIRA READ-ONLY POLICY:**
- ‚úÖ ALLOWED: Fetching issues, reading descriptions, reading comments
- ‚ùå FORBIDDEN: Adding comments, updating fields, changing status, creating issues
- All JIRA access is READ-ONLY - no modifications will be made to JIRA
- Users must manually update JIRA issues based on the generated report

**REPOSITORY READ-ONLY POLICY:**
- ‚úÖ ALLOWED: Reading repository information from JIRA, analyzing CVEs
- ‚ùå FORBIDDEN: Editing files, creating branches, making commits, creating PRs
- All repository access is READ-ONLY - no code changes will be made
- Workflow provides **instructions only** - user implements fixes manually

**GitHub Repository Detection:**
- Workflow attempts to extract repository from JIRA issue automatically
- Searches: description, comments, custom fields
- If not found: prompts user for repository information
- If found: confirms with user before proceeding

**Processing Behavior:**
- **ALL issues are processed** - no sampling or partial processing
- Processing stops only if JIRA authentication fails
- Issues are processed sequentially to avoid rate limiting
- **Progress shown for each issue** - user sees exactly what's happening
- The command respects JIRA rate limits (adds delays between API calls)
- **Duplicate CVEs are detected** and grouped together
- Closed issues are analyzed to understand existing fixes
- No limit on number of issues - processes component entirely

**What User Sees:**
- Real-time progress counter: [3/15] Processing SEC-1234...
- Status of each issue as it's processed
- CVE grouping results
- Open vs Closed breakdown
- Which CVEs need fixes vs already fixed

## JIRA Query Examples

The command uses JQL (JIRA Query Language) internally:

```jql
# Main query - gets ALL CVE issues (both open and closed)
component = "security" AND summary ~ "CVE"

# This includes:
# - Open issues (In Progress, To Do, Open, etc.)
# - Closed issues (Done, Resolved, Closed, etc.)
# - All priority levels (Critical, High, Medium, Low)

# The workflow then categorizes them after fetching
```

**Why fetch ALL issues (not just unresolved)?**
- Closed issues often contain fix information
- Helps identify duplicate CVEs
- Shows what's already been resolved
- Provides complete picture of CVE landscape

## Error Handling

- **Component not found**: Suggests similar component names
- **No issues found**: Confirms query and suggests expanding search
- **JIRA authentication failure**: Prompts to check environment variables
- **Rate limit exceeded**: Automatically waits and retries
- **Fix application failure**: Logs error and continues to next issue
