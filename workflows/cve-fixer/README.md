# CVE Fixer

Analyze unresolved CVE issues from JIRA, categorize them by severity and fix availability, and automatically create pull requests with security fixes.

## Overview

This workflow helps you manage CVE vulnerabilities tracked in JIRA by:
1. Fetching unresolved CVE issues from a specified JIRA component
2. Categorizing them by severity (Critical, High, Medium, Low) and fix availability
3. Presenting a concise summary
4. Asking which CVEs you want to fix
5. Automatically applying fixes and creating pull requests

**Key Features:**
- üìä Concise summaries - Quick categorization by severity and fix status
- üîç Unresolved focus - Only processes open CVEs (excludes closed/resolved)
- ü§ñ Automated fixing - Creates branches, applies fixes, runs tests, makes PRs
- üîí JIRA read-only - Never updates or modifies JIRA issues
- üìù Comprehensive PRs - Detailed descriptions with CVE context (no JIRA links)
- ‚ú® Version checking - Uses newer versions if available than JIRA mentions

## Getting Started

### Prerequisites
- JIRA MCP server configured with credentials:
  - `JIRA_URL` - Your JIRA instance URL
  - `JIRA_EMAIL` - Your JIRA email
  - `JIRA_API_TOKEN` - Your JIRA API token
- Git configured with access to target repositories
- `gh` CLI installed and authenticated (for creating PRs)
- JIRA component name where CVE issues are tracked
- Repository/repositories where fixes should be applied

### Installation
1. Ensure JIRA MCP server is configured (see `.mcp.json` in project root)
2. Set environment variables:
   ```bash
   export JIRA_URL="https://your-company.atlassian.net"
   export JIRA_EMAIL="your-email@example.com"
   export JIRA_API_TOKEN="your-token"
   ```
3. Load the workflow in your ACP session
4. Run `/cve-fixer.process` to begin

## Workflow Process

### Single Command Workflow
**Command:** `/cve-fixer.process`

This command handles the entire CVE fixing workflow:

**Phase 1: Gather Information**
- Asks for JIRA component name
- Asks for repository/repositories where fixes should be applied
- Validates access to both JIRA and repositories

**Phase 2: Fetch and Analyze**
- Fetches UNRESOLVED CVEs only (excludes Closed, Done, Resolved)
- Uses JQL: `component = "X" AND summary ~ "CVE" AND status NOT IN (...)`
- Extracts CVE IDs, severity, and fix information from each issue
- Categorizes by severity (Critical, High, Medium, Low)
- Categorizes by fix availability (with fixes vs without)

**Phase 3: Present Summary**
Shows concise breakdown:
```
üìä CVE Analysis for Component: security

Total Unresolved CVEs: 8

By Severity:
‚Ä¢ Critical: 2 CVEs
‚Ä¢ High: 3 CVEs
‚Ä¢ Medium: 2 CVEs
‚Ä¢ Low: 1 CVE

Fix Availability:
‚Ä¢ CVEs with fixes mentioned: 5
  - CVE-2025-66031 (Critical) - Upgrade node-forge to 1.3.2
  - CVE-2024-1234 (High) - Upgrade lodash to 4.17.21
  ...

‚Ä¢ CVEs without current fixes: 3
  - CVE-2024-7777 (Critical) - No fix information in JIRA
  ...
```

**Phase 4: Ask User**
Presents options:
1. Fix a specific CVE
2. Fix all CVEs with fixes mentioned
3. Skip

**Phase 5: Apply Fixes**
For each CVE to fix:
- Extracts fix details from JIRA description
- Checks package registry for newer versions
- Clones repository
- Creates feature branch: `fix/cve-{cve-id}`
- Updates dependency files (package.json, requirements.txt, etc.)
- Runs tests if available
- Commits changes with detailed message
- Creates pull request with comprehensive description
- **Important:** PRs never include JIRA issue links

**Phase 6: Generate Report**
- Creates fix summary in `artifacts/cve-fixer/fixes/`
- Lists which CVEs were fixed with PR URLs
- Lists which CVEs were skipped and why

## Available Agent

### Security Engineer - CVE Fixer Specialist
Focused on analyzing unresolved CVE vulnerabilities and automatically fixing them.

**Expertise:**
- CVE database analysis and vulnerability research
- JIRA issue analysis (read-only)
- Automated patch application and dependency management
- Git workflow and pull request creation
- Package registry version checking

**Key Principles:**
- JIRA read-only - never updates JIRA issues
- Unresolved only - filters out closed/resolved CVEs
- Concise summaries - short categorized breakdowns
- User choice - asks which CVEs to fix
- Version checking - uses newer versions if available
- No JIRA links in PRs - keeps PRs clean

## Output Artifacts

All workflow outputs are saved in `artifacts/cve-fixer/`:

```
artifacts/cve-fixer/
‚îú‚îÄ‚îÄ reports/        # CVE analysis summaries
‚îî‚îÄ‚îÄ fixes/          # Fix summary reports with PR links
```

## Example Usage

### Basic Usage
```bash
# Start the CVE fixing workflow
/cve-fixer.process

# You'll be prompted for:
# 1. JIRA component name (e.g., "security")
# 2. Repository/repositories (e.g., "https://github.com/user/repo")

# Review the summary, select which CVEs to fix

# PRs will be created automatically
# Review summary report in artifacts/cve-fixer/fixes/
```

### Example Workflow
```
> /cve-fixer.process

Which JIRA component contains the CVE issues you want to analyze?
> security

Which repository/repositories should I apply fixes to?
> https://github.com/myorg/backend-api

üîç Fetching unresolved CVEs from component 'security'...
Found 5 unresolved CVE issues

üìä Analyzing CVEs...

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìä CVE Analysis for Component: security
...
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Which CVEs would you like me to fix?
1. Fix a specific CVE
2. Fix all CVEs with fixes mentioned (4 CVEs)
3. Skip

> 2

üöÄ Fixing 4 CVEs...

[1/4] Fixing CVE-2025-66031...
  üîß Preparing fix information...
  ‚ÑπÔ∏è Newer version available: 1.3.3 (JIRA recommended 1.3.2)
  üì¶ Setting up repository...
  ‚úèÔ∏è Updating package.json...
  üß™ Running tests... ‚úÖ Passed
  üíæ Committing changes...
  üì§ Creating pull request...
  ‚úÖ PR created: https://github.com/myorg/backend-api/pull/123

...

‚úÖ All fixes complete!
üìÑ Summary report: artifacts/cve-fixer/fixes/fix-summary-security-20260130.md
```

## Configuration

This workflow is configured via `.ambient/ambient.json`:

- **Name:** CVE Fixer
- **Description:** Analyze unresolved JIRA CVE issues, categorize by severity, and automatically fix CVEs by creating pull requests
- **Artifact Paths:**
  - CVE Analysis Reports: `artifacts/cve-fixer/reports/**/*.md`
  - Fix Logs: `artifacts/cve-fixer/fixes/**/*.md`

## JIRA Query

The workflow uses JQL (JIRA Query Language) to fetch unresolved CVEs:

```jql
component = "COMPONENT_NAME" AND summary ~ "CVE" AND status NOT IN (Closed, Done, Resolved)
```

This excludes:
- Closed issues
- Done issues
- Resolved issues

Only open/unresolved CVE issues are processed.

## Pull Request Format

Pull requests created by this workflow include:

**Title:** `Fix {CVE-ID}: {Brief description}`

**Description:**
```markdown
## Security Fix: CVE-2025-66031

**Severity:** Critical

### Vulnerability Description
{What the CVE is and why it's dangerous}

### Fix Applied
- Updated `node-forge` from version `1.3.1` to `1.3.3`
- {Additional details}

‚ÑπÔ∏è **Note:** A newer fix version (1.3.3) was available and applied
instead of the originally recommended version (1.3.2).

### Files Modified
- `package.json`

### Testing
‚úÖ All tests passed

### References
- CVE Details: https://nvd.nist.gov/vuln/detail/CVE-2025-66031
- Package Security Advisory: {link if available}

---
ü§ñ Generated with Claude Code CVE Fixer
```

**Important:** PRs never include JIRA issue links or references.

## Best Practices

1. **Review summaries before fixing** - Understand what CVEs exist before taking action
2. **Fix critical/high severity first** - Prioritize by impact
3. **Review PRs before merging** - Verify fixes are correct
4. **Test in staging** - Don't merge directly to production
5. **Update JIRA manually** - Add PR links to JIRA issues if desired (workflow doesn't do this)
6. **Monitor newer versions** - Workflow checks for updates, but stay vigilant

## Error Handling

The workflow handles common errors gracefully:

- **Component not found:** Suggests similar component names
- **No unresolved CVEs:** Confirms and exits
- **JIRA authentication failure:** Prompts to check environment variables
- **Repository access failure:** Shows error and asks for correct URL
- **Test failures:** Asks whether to continue with PR or skip
- **PR creation failure:** Logs error, saves local changes, continues to next CVE

## Customization

You can customize this workflow by:

1. **Modifying JQL query** - Edit the query in `cve-fixer.process.md` to change what issues are fetched
2. **Adjusting severity categories** - Modify the categorization logic
3. **Changing PR format** - Edit the PR description template in the command file
4. **Adding pre-commit checks** - Extend the testing phase
5. **Updating the agent** - Edit `.claude/agents/security-engineer.md`

## Troubleshooting

### JIRA Connection Issues
```bash
# Verify environment variables are set
echo $JIRA_URL
echo $JIRA_EMAIL
echo $JIRA_API_TOKEN

# Test JIRA connection
curl -u $JIRA_EMAIL:$JIRA_API_TOKEN $JIRA_URL/rest/api/2/myself
```

### GitHub PR Creation Issues
```bash
# Verify gh CLI is authenticated
gh auth status

# Login if needed
gh auth login
```

### Test Failures
If tests fail during fixing:
- Workflow will ask if you want to continue anyway
- You can skip that CVE and move to the next
- Or abort all remaining fixes

## Next Steps

After PRs are created:
1. Review each PR for accuracy
2. Request code review from team members
3. Run additional tests in CI/CD
4. Merge PRs after approval
5. Monitor deployment
6. Manually update JIRA issues with PR links if desired

## Contributing

To improve this workflow:
1. Fork the repository
2. Make your changes
3. Test thoroughly
4. Submit a pull request

## License

MIT

## Support

For issues or questions:
- Open an issue in the repository
- Refer to the [ACP documentation](https://ambient-code.github.io/vteam)

---

**Created with:** ACP Workflow Creator
**Workflow Type:** Custom
**Version:** 2.0.0
